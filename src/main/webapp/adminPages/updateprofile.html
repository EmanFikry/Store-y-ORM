<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    </head>
    <body>

        <label>Name</label><br>
        <input type="text" name="name" id="name" maxlength="100" onblur="checkName()" required><br>
        <label id="nameError"></label>

        <label>email</label><br>
        <input type="email" name="email" id="email" maxlength="50" onblur="checkEmail()" required><br>
        <label id="emailError"></label>

        <label>Password</label><br>
        <input type="password" name="password" maxlength="50" id="pass" onblur="checkPasswordStrength()" required><br>
        <label id="passStrength"></label>

        <label>Confirm Password</label><br>
        <input type="password" name="cpassword" maxlength="50" id="cpassword" onblur="checkPassword()" required><br>
        <label id="passwordError"></label>

        <label>Date OF Birth</label><br>
        <input type="date" max="2000-02-28" name="date" id="date" required><br>
        <label id="dateError"></label>

        <label for="uInterests"><b>Interests</b></label>
        <br>
        <input type="checkbox" class="uInterests" value="Baby" />Baby<br/>
        <input type="checkbox" class="uInterests" value="Beauty" />Beauty<br/>
        <input type="checkbox" class="uInterests" value="Computers" />Computers<br/>
        <input type="checkbox" class="uInterests" value="Home Decor & Furniture" />Home Decor & Furniture<br/>
        <input type="checkbox" class="uInterests" value="Jewelry & Accessories" />Jewelry & Accessories<br/>
        <input type="checkbox" class="uInterests" value="Mobile Phones, Tablets & Accessories" />Mobile Phones, Tablets & Accessories<br/>
        <label for="uJob"><b>Job</b></label>
        <br>
        <select id="uJob">
            <option value="student">Student</option>
            <option value="teacher">Teacher</option>
            <option value="engineer">Engineer</option>
            <option value="doctor">Doctor</option>
            <option value="other">Other</option>
        </select>
        <br>
        <label>User Credit</label><br>
        <input type="number" name="credit" min="1" id="credit" required><br>
        <label id="creditLimitError"></label>

        <label>Address</label><br>
        <input type="text" maxlength="70" name="address" id="address" required><br>

        <input type="hidden" id="uCategory" name="uCategory" value="done">
        <input type="hidden" id="userJob" name="userJob" value="done">

        <input type="button" id="submit" value="button"/><br>


        <script>
            function checkPasswordStrength()
            {
                var strength = {
                    0: "Worst",
                    1: "Bad",
                    2: "Weak",
                    3: "Good",
                    4: "Strong"
                }
                var val = document.getElementById('upassword').value;
                var result = zxcvbn(val);

                // Update the text indicator
                if (val !== "") {
                    document.getElementById('passStrength').innerHTML = "Strength: " + strength[result.score];
                } else {
                    document.getElementById('passStrength').innerHTML.innerHTML = "";
                }
            }

            function checkName()
            {
                var nameRegex = /^[a-zA-Z]+([ ][a-zA-Z]*)*$/;
                if (document.getElementById('name').value.match(nameRegex))
                {
                    document.getElementById('nameError').value = "";
                    validName = true;
                    console.log(validName);
                } else {
                    document.getElementById('nameError').value = "Wrong Format";
                }
            }

            function checkEmail()
            {
                var emailRegex = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;

                if (emailRegex.test(document.getElementById('email').value))
                {
                    document.getElementById('emailError').innerHTML = "";

                    $.ajax({
                        url: "SignUpServlet",
                        type: 'GET',
                        contentType: 'application/json',
                        data: {'temail': document.getElementById('uemail').value},
                        error: function (xhr, status, error) {
                            console.log(xhr);
                            console.log(status);
                            console.log(error);
                        },
                        success: function (data)
                        {
                            $("#emailError").text(data);
                            console.log(data);
                            if (data !== null && data !== '')
                            {
                                validEmail = false;
                            } else
                            {
                                validEmail = true;
                            }
                            console.log(validEmail);
                        }});

                    console.log(validEmail);
                } else {
                    document.getElementById('emailError').innerHTML = "Wrong Format";
                    console.log("here");
                }
            }

            function checkPassword()
            {

                if (document.getElementById('pass').value === document.getElementById('cpassword').value)
                {

                    document.getElementById('passwordError').value = "";
                    validPass = true;
                    console.log(validPass);
                } else {
                    console.log("here");
                    document.getElementById('passwordError').value = "Passwords do not match";
                }
            }


            function beforeSubmit()
            {

                document.getElementById('userJob').value = document.getElementById("job").value;

                var checkedValue = '';
                var inputElements = document.getElementsByClassName('uInterests');
                for (var i = 0; inputElements[i]; i++) {
                    if (inputElements[i].checked) {
                        checkedValue = checkedValue + inputElements[i].value + ";";
                    }
                }
                if (checkedValue != null) {
                    document.getElementById('uCategory').value = checkedValue;
                }
            }


            $(document).ready(function () {
                $("#submit").click(function () {
                    beforeSubmit();
                    name_var = $("#name").val();
                    password_var = $("#pass").val();
                    email_var = $("#email").val();
                    credit_var = $("#credit").val();
                    job_var = $("#job").val();
                    address_var = $("#address").val();
                    birthdate_var = $("#date").val();
                    interests_var = $("#uCategory").val();
                    $.post("UpdateUserServlet",
                            {
                                name: name_var,
                                email: email_var,
                                password: password_var,
                                birthdate: birthdate_var,
                                job: job_var,
                                address: address_var,
                                credit: credit_var,
                                interests: interests_var

                            },
                            function () {
                                alert("success");
                            });
                });
            });

        </script>
    </body>
</html>
